<h2>Application Deployments</h2>
<style>
  html, body {
    padding: 5px;
  }

  .data-table {
    font-family: calibri, arial;
    width: 100%;
  }

  tr:hover {
    cursor: pointer
  }

  .data-table thead td {
    background-color: #8CCCF1;
    font-weight: bold;
  }

  .data-table td {
    border: 1px solid #466E85;
    width: 136px;
    padding: 7px;
  }
</style>

<% @deployments.each do |deployment| %>
    <%= render partial: 'app_deployment_table', locals: {deployment: deployment} %>
<% end %>
<script>
  $(document).ready(function () {
    $('td[data-href]').on("click", function () {
      window.open($(this).data('href'));
    });

    <%= render '/ajax_flash.js'  %>
  });

  function tomcat_app(elem, tomcat_service_id, action, app) {
    var btn = '#' + elem.id + ' > i';
    if ($(btn).hasClass('processing')) {
      console.log('stop clicking on the ' + action + ' button!!!!');
      return false;
    }

    // change the icon to the spinner and make the ajax call
    $(btn).removeClass();
    $(btn).addClass('fa fa-cog fa-spin fa-fw');

    //find all buttons in the div to add the prisme_processing class to so that the user cannot, for example, start and undeploy the app at the same time
    var clean_id = 'div#' + tomcat_service_id.toString() + '-' + app.split('.').join('_') + ', i';
    $(clean_id).addClass('processing');

    $.ajax({
      url: gon.routes.welcome_tomcat_app_action_path,
      type: 'GET',
      data: {tomcat_service_id: tomcat_service_id, tomcat_action: action, tomcat_app: app},
      success: function (data) {
        $("#tp-deployments").html(data);
      }
    });
  }
</script>
